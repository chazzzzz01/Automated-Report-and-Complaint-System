<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAD Office</title>
    <style>
        /* Existing styles */
        #reports-table, #complaints-table, #buttons-container, 
        #history-buttons-container, #history-reports-table, #history-complaints-table,
        #messages-container, #dashboard-container {
            display: none; /* Initially hidden */
        }
        #reports-table.visible, #complaints-table.visible, #buttons-container.visible,
        #history-buttons-container.visible, #history-reports-table.visible, #history-complaints-table.visible,
        #messages-container.visible, #dashboard-container.visible {
            display: block; /* Show when the 'visible' class is added */
        }
        #status-link, #history-link, #messages-link, #dashboard-link {
            color: blue;
            cursor: pointer;
            text-decoration: underline;
            margin-right: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .status {
            font-weight: bold;
        }
        .status-pending {
            background-color: red; /* Red for pending */
            color: white;
        }
        .status-in-progress {
            background-color: yellow; /* Yellow for in progress */
            color: black;
        }
        .status-solved {
            background-color: green; /* Green for solved */
            color: white;
        }
        /* Added styles for dashboard */
        .dashboard-box {
            background-color: #f9f9f9;
            padding: 20px;
            border: 1px solid #ccc;
            margin-top: 20px;
            width: 300px;
        }
        .dashboard-box h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <h1>GAD Office</h1>

   <a href="{% url 'dashboard_page' %}">Dashboard</a>
    <p id="status-link" onclick="toggleVisibility('buttons-container', 'reports-table', 'complaints-table', 'dashboard-container', 'history-buttons-container', 'messages-container')">Status</p>
    <p id="history-link" onclick="toggleVisibility('history-buttons-container', 'history-reports-table', 'history-complaints-table', 'dashboard-container', 'buttons-container', 'messages-container')">History</p>
    <p id="messages-link" onclick="toggleMessagesVisibility()">Messages</p>

   

    <!-- Buttons for Reports and Complaints -->
    <div id="buttons-container">
        <button onclick="showSection('reports-table', 'complaints-table')">Reports</button>
        <button onclick="showSection('complaints-table', 'reports-table')">Complaints</button>
    </div>

    <!-- History Buttons for Reports and Complaints -->
    <div id="history-buttons-container">
        <button onclick="showSection('history-reports-table', 'history-complaints-table')">Solved Reports</button>
        <button onclick="showSection('history-complaints-table', 'history-reports-table')">Solved Complaints</button>
    </div>

    <!-- Table for Reports -->
    <div id="reports-table">
        <h2>Reports</h2>
        <table>
            <thead>
                <tr>
                    <th>Office</th>
                    <th>Type</th>
                    <th>Description (PDF)</th>
                    <th>Status</th>
                    <th>Issue Date</th>
                    <th>Update Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="reports-body">
                {% for report in reports %}
                {% if report.status != "Solved" %}
                <tr data-id="{{ report.id }}">
                    <td>{{ report.office }}</td>
                    <td>{{ report.type }}</td>
                    <td>
                        {% if report.pdf_file %}
                            <a href="{{ report.pdf_file.url }}" target="_blank">Download PDF</a>
                        {% else %}
                            No PDF available
                        {% endif %}
                    </td>
                    <td class="status {% if report.status == 'Pending' %}status-pending{% elif report.status == 'In Progress' %}status-in-progress{% elif report.status == 'Solved' %}status-solved{% endif %}">
                        {{ report.status }}
                    </td>
                    <td>{{ report.issue_date|date:"F j, Y" }}</td>

                    <td>
                        <form action="{% url 'update_status' report.id %}" method="post">
                            {% csrf_token %}
                            <select name="status">
                                <option value="Pending" {% if report.status == "Pending" %}selected{% endif %}>Pending</option>
                                <option value="In Progress" {% if report.status == "In Progress" %}selected{% endif %}>In Progress</option>
                                <option value="Solved" {% if report.status == "Solved" %}selected{% endif %}>Solved</option>
                            </select>
                            <input type="hidden" name="redirect_url" value="{% url 'gad_office_page' %}">
                            <button type="submit">Update</button>
                        </form>
                    </td>
                    
                    <td>
                        <button class="delete-btn" onclick="deleteComplaint('{{ complaint.id }}')">Delete</button>
                    </td>

                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Table for Complaints -->
    <div id="complaints-table">
        <h2>Complaints</h2>
        <table>
            <thead>
                <tr>
                    <th>Office</th>
                    <th>Type</th>
                    <th>Description (PDF)</th>
                    <th>Status</th>
                    <th>Issue Date</th>
                    <th>Update Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="complaints-body">
                {% for complaint in complaints %}
                {% if complaint.status != "Solved" %}
                <tr data-id="{{ complaint.id }}">
                    <td>{{ complaint.office }}</td>
                    <td>{{ complaint.type }}</td>
                    <td>
                        {% if complaint.pdf_file %}
                            <a href="{{ complaint.pdf_file.url }}" target="_blank">Download PDF</a>
                        {% else %}
                            No PDF available
                        {% endif %}
                    </td>
                    <td class="status {% if complaint.status == 'Pending' %}status-pending{% elif complaint.status == 'In Progress' %}status-in-progress{% elif complaint.status == 'Solved' %}status-solved{% endif %}">
                        {{ complaint.status }}
                    </td>
                    <td>{{ complaint.issue_date|date:"F j, Y" }}</td>
                    <td>
                        <form action="{% url 'update_status' complaint.id %}" method="post">
                            {% csrf_token %}
                            <select name="status">
                                <option value="Pending" {% if complaint.status == "Pending" %}selected{% endif %}>Pending</option>
                                <option value="In Progress" {% if complaint.status == "In Progress" %}selected{% endif %}>In Progress</option>
                                <option value="Solved" {% if complaint.status == "Solved" %}selected{% endif %}>Solved</option>
                            </select>
                            <input type="hidden" name="redirect_url" value="{% url 'gad_office_page' %}">
                            <button type="submit">Update</button>
                        </form>
                    </td>
                    <td><!-- Action buttons or links can go here --></td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- History Tables -->
    <div id="history-reports-table">
        <h2>Solved Reports</h2>
        <table>
            <thead>
                <tr>
                    <th>Office</th>
                    <th>Type</th>
                    <th>Description (PDF)</th>
                    <th>Status</th>
                    <th>Issue Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="history-reports-body">
                {% for report in reports %}
                {% if report.status == "Solved" %}
                <tr data-id="{{ report.id }}">
                    <td>{{ report.office }}</td>
                    <td>{{ report.type }}</td>
                    <td>
                        {% if report.pdf_file %}
                            <a href="{{ report.pdf_file.url }}" target="_blank">Download PDF</a>
                        {% else %}
                            No PDF available
                        {% endif %}
                    </td>
                    <td class="status status-solved">{{ report.status }}</td>
                    <td>{{ report.issue_date|date:"F j, Y" }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="history-complaints-table">
        <h2>Solved Complaints</h2>
        <table>
            <thead>
                <tr>
                    <th>Office</th>
                    <th>Type</th>
                    <th>Description (PDF)</th>
                    <th>Status</th>
                    <th>Issue Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="history-complaints-body">
                {% for complaint in complaints %}
                {% if complaint.status == "Solved" %}
                <tr data-id="{{ complaint.id }}">
                    <td>{{ complaint.office }}</td>
                    <td>{{ complaint.type }}</td>
                    <td>
                        {% if complaint.pdf_file %}
                            <a href="{{ complaint.pdf_file.url }}" target="_blank">Download PDF</a>
                        {% else %}
                            No PDF available
                        {% endif %}
                    </td>
                    <td class="status status-solved">{{ complaint.status }}</td>
                    <td>{{ complaint.issue_date|date:"F j, Y" }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Messages Section -->
    <div id="messages-container">
        <h2>Messages</h2>
        <ul id="messages-list">
            <!-- Messages will be dynamically inserted here -->
        </ul>
        <form id="message-form" onsubmit="sendMessage(event)">
            <textarea id="message-text" name="message" rows="4" cols="50" placeholder="Type your message here..."></textarea>
            <input type="hidden" id="recipient-id" name="recipient_id" value="">
            <button type="submit">Send</button>
        </form>
    </div>






   <!-- Existing Dashboard Container -->
<div id="dashboard-container" class="dashboard-box">
    <h2>Total Report and Complaint</h2>
    <p>Reports Received: <span id="total-reports">0</span></p>
    <p>Complaints Received: <span id="total-complaints">0</span></p>
</div>

<!-- New Container for Solved Reports and Complaints -->
<div id="solved-container" class="dashboard-box" style="display: none;">
    <h2>Solved Reports and Complaints</h2>
    <p>Reports Solved: <span id="solved-reports">0</span></p>
    <p>Complaints Solved: <span id="solved-complaints">0</span></p>
</div>
    
    
    
    
    
    
    
    <script>
        function toggleVisibility(containerId, ...otherIds) {
    const container = document.getElementById(containerId);
    container.style.display = container.style.display === 'none' ? 'block' : 'none';

    otherIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = 'none';
        }
    });
}

function toggleDashboardVisibility() {
    const dashboardContainer = document.getElementById('dashboard-container');
    const solvedContainer = document.getElementById('solved-container');

    const isDashboardVisible = dashboardContainer.style.display === 'block';

    dashboardContainer.style.display = isDashboardVisible ? 'none' : 'block';
    solvedContainer.style.display = isDashboardVisible ? 'none' : 'block';

    // Hide other sections
    document.getElementById('buttons-container').style.display = 'none';
    document.getElementById('reports-table').style.display = 'none';
    document.getElementById('complaints-table').style.display = 'none';
    document.getElementById('history-buttons-container').style.display = 'none';
    document.getElementById('history-reports-table').style.display = 'none';
    document.getElementById('history-complaints-table').style.display = 'none';
    document.getElementById('messages-container').style.display = 'none';

    if (!isDashboardVisible) {
        fetchTotals();
    }
}

function fetchTotals() {
    // Use template variables rendered by the server-side template engine.
    const totalReports = Number('{{ reports|length }}'); 
    const totalComplaints = Number('{{ complaints|length }}');
    const solvedReports = Number('{{ solved_reports|length }}');
    const solvedComplaints = Number('{{ solved_complaints|length }}');

    // Ensure these variables are correctly rendered as numbers
    if (!isNaN(totalReports) && !isNaN(totalComplaints) && !isNaN(solvedReports) && !isNaN(solvedComplaints)) {
        document.getElementById('total-reports').textContent = totalReports;
        document.getElementById('total-complaints').textContent = totalComplaints;
        document.getElementById('solved-reports').textContent = solvedReports;
        document.getElementById('solved-complaints').textContent = solvedComplaints;
    } else {
        console.error('Failed to fetch totals.');
    }
}

function showSection(visibleId, hiddenId) {
    document.getElementById(visibleId).style.display = 'block';
    document.getElementById(hiddenId).style.display = 'none';
}
















    
        function toggleMessagesVisibility() {
            const messagesContainer = document.getElementById('messages-container');
            messagesContainer.style.display = messagesContainer.style.display === 'none' ? 'block' : 'none';
    
            // Hide other sections
            document.getElementById('dashboard-container').style.display = 'none';
            document.getElementById('buttons-container').style.display = 'none';
            document.getElementById('reports-table').style.display = 'none';
            document.getElementById('complaints-table').style.display = 'none';
            document.getElementById('history-buttons-container').style.display = 'none';
            document.getElementById('history-reports-table').style.display = 'none';
            document.getElementById('history-complaints-table').style.display = 'none';
    
            if (messagesContainer.style.display === 'block') {
                fetchMessages();
            }
        }



    function toggleMessagesVisibility() {
        const messagesContainer = document.getElementById('messages-container');
        messagesContainer.style.display = messagesContainer.style.display === 'none' ? 'block' : 'none';

        // Hide other sections
        document.getElementById('dashboard-container').style.display = 'none';
        document.getElementById('solved-container').style.display = 'none';
        document.getElementById('buttons-container').style.display = 'none';
        document.getElementById('reports-table').style.display = 'none';
        document.getElementById('complaints-table').style.display = 'none';
        document.getElementById('history-buttons-container').style.display = 'none';
        document.getElementById('history-reports-table').style.display = 'none';
        document.getElementById('history-complaints-table').style.display = 'none';

        if (messagesContainer.style.display === 'block') {
            fetchMessages();
        }
    }



    function fetchMessages() {
        fetch('/api/messages')  // Replace with your endpoint
            .then(response => response.json())
            .then(data => {
                const messagesList = document.getElementById('messages-list');
                messagesList.innerHTML = ''; // Clear existing messages
                data.messages.forEach(message => {
                    const listItem = document.createElement('li');
                    listItem.textContent = message.text;  // Adjust according to your message structure
                    listItem.dataset.id = message.id; // Store message ID for replying
                    listItem.onclick = function() {
                        document.getElementById('recipient-id').value = message.id; // Set recipient ID
                    };
                    messagesList.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error fetching messages:', error));
    }

    function sendMessage(event) {
        event.preventDefault();
        const messageText = document.getElementById('message-text').value;
        const recipientId = document.getElementById('recipient-id').value;

        fetch('/api/send_message', { // Replace with your endpoint
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}' // Ensure this token is correctly rendered
            },
            body: JSON.stringify({ message: messageText, recipient_id: recipientId })
        })
        .then(response => {
            if (response.ok) {
                document.getElementById('message-text').value = ''; // Clear the textarea
                document.getElementById('recipient-id').value = ''; // Clear recipient ID
                fetchMessages(); // Refresh messages
            } else {
                console.error('Error sending message');
            }
        })
        .catch(error => console.error('Error sending message:', error));
    }

    
    
</script>

</body>
</html>
